<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-fullscreen">
    <title>Flexi Visitor Sign-In</title>
    <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@300;400;500;600;700;800&display=swap" rel="stylesheet">
    <style>
        :root {
            --red: #DC2626;
            --red-hover: #EF4444;
            --red-dim: rgba(220, 38, 38, 0.15);
            --red-border: rgba(220, 38, 38, 0.35);
            --bg: #000000;
            --card: #111111;
            --card2: #1A1A1A;
            --text: #E5E5E5;
            --muted: rgba(255,255,255,0.5);
            --border: rgba(255,255,255,0.08);
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            -webkit-tap-highlight-color: transparent;
        }

        html, body {
            height: 100%;
            overflow: hidden;
        }

        body {
            font-family: 'Barlow Condensed', sans-serif;
            background: var(--bg);
            color: var(--text);
            position: fixed;
            width: 100vw;
            height: 100vh;
            top: 0;
            left: 0;
        }

        /* ‚îÄ‚îÄ‚îÄ LAYOUT ‚îÄ‚îÄ‚îÄ */
        .shell {
            max-width: 860px;
            margin: 0 auto;
            height: 100%;
            display: flex;
            flex-direction: column;
            padding: 14px 16px;
        }

        /* ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ */
        .header {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--card);
            border: 1px solid var(--red-border);
            border-radius: 10px;
            padding: 12px 20px;
            margin-bottom: 12px;
            flex-shrink: 0;
        }

        .header-logo img {
            height: 42px;
            display: block;
        }

        .header-center {
            text-align: center;
        }

        .header-center .site-sub {
            font-size: 0.95em;
            color: var(--muted);
            font-weight: 400;
        }

        .header-clock {
            text-align: right;
        }

        .header-clock .time {
            font-size: 1.6em;
            font-weight: 700;
            color: var(--red-hover);
            letter-spacing: 1px;
        }

        .header-clock .date {
            font-size: 0.85em;
            color: var(--muted);
        }

        /* ‚îÄ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ */
        .screen {
            display: none;
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .screen.active {
            display: flex;
            flex-direction: column;
        }

        .screen::-webkit-scrollbar { width: 6px; }
        .screen::-webkit-scrollbar-track { background: transparent; }
        .screen::-webkit-scrollbar-thumb { background: var(--red); border-radius: 4px; }

        /* ‚îÄ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ‚îÄ */
        .card {
            background: var(--card);
            border: 1px solid var(--border);
            border-radius: 10px;
            padding: 18px 20px;
            margin-bottom: 10px;
        }

        .card.red-accent {
            border-color: var(--red-border);
        }

        /* ‚îÄ‚îÄ‚îÄ SCREEN TITLES ‚îÄ‚îÄ‚îÄ */
        .screen-title {
            font-size: 2em;
            font-weight: 800;
            color: var(--red-hover);
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 2px;
        }

        .screen-sub {
            font-size: 1em;
            color: var(--muted);
            margin-bottom: 14px;
        }

        /* ‚îÄ‚îÄ‚îÄ WELCOME SCREEN ‚îÄ‚îÄ‚îÄ */
        #welcomeScreen {
            gap: 10px;
        }

        .welcome-hero {
            background: var(--card);
            border: 1px solid var(--red-border);
            border-radius: 10px;
            padding: 22px 20px;
            text-align: center;
        }

        .welcome-hero .title {
            font-size: 2.4em;
            font-weight: 800;
            color: #fff;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 4px;
        }

        .welcome-hero .tagline {
            font-size: 1.1em;
            color: var(--muted);
            font-weight: 400;
        }

        .stats-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .stat-card {
            background: var(--card);
            border: 1px solid var(--red-border);
            border-radius: 10px;
            padding: 18px 16px;
            text-align: center;
        }

        .stat-label {
            font-size: 0.9em;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 6px;
        }

        .stat-value {
            font-size: 3em;
            font-weight: 800;
            color: var(--red-hover);
            line-height: 1;
        }

        .btn-row {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            margin-top: auto;
        }

        /* ‚îÄ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ‚îÄ */
        .btn {
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.4em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 1px;
            border: none;
            border-radius: 8px;
            padding: 20px 16px;
            cursor: pointer;
            transition: all 0.15s ease;
            width: 100%;
        }

        .btn-primary {
            background: var(--red);
            color: #fff;
        }

        .btn-primary:active {
            background: var(--red-hover);
            transform: scale(0.98);
        }

        .btn-outline {
            background: transparent;
            color: var(--text);
            border: 2px solid var(--red-border);
        }

        .btn-outline:active {
            background: var(--red-dim);
            transform: scale(0.98);
        }

        .btn-sm {
            font-size: 1em;
            padding: 12px 16px;
        }

        .btn-danger {
            background: #7f1d1d;
            color: #fca5a5;
            border: 1px solid #dc2626;
        }

        /* ‚îÄ‚îÄ‚îÄ FORM ‚îÄ‚îÄ‚îÄ */
        .form-grid {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
        }

        .form-group {
            margin-bottom: 10px;
        }

        .form-group.full {
            grid-column: 1 / -1;
        }

        label {
            display: block;
            font-size: 0.85em;
            font-weight: 600;
            color: var(--muted);
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 5px;
        }

        .req {
            color: var(--red-hover);
            margin-left: 2px;
        }

        input, select {
            width: 100%;
            background: var(--card2);
            border: 1px solid var(--border);
            border-radius: 6px;
            color: #fff;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 1.05em;
            font-weight: 500;
            padding: 11px 13px;
            transition: border-color 0.15s;
            -webkit-appearance: none;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--red);
            background: #1f1f1f;
        }

        input::placeholder { color: rgba(255,255,255,0.25); }

        select option {
            background: #1a1a1a;
            color: #fff;
        }

        /* ‚îÄ‚îÄ‚îÄ PROGRESS BAR ‚îÄ‚îÄ‚îÄ */
        .progress-track {
            height: 4px;
            background: rgba(255,255,255,0.08);
            border-radius: 4px;
            margin-bottom: 14px;
            overflow: hidden;
        }

        .progress-fill {
            height: 100%;
            background: var(--red);
            border-radius: 4px;
            width: 0%;
            transition: width 0.3s ease;
        }

        /* ‚îÄ‚îÄ‚îÄ INFO PANELS ‚îÄ‚îÄ‚îÄ */
        .info-panel {
            border-radius: 8px;
            padding: 14px 16px;
            margin-bottom: 10px;
        }

        .info-panel.safety {
            background: #1a0000;
            border: 1px solid var(--red-border);
        }

        .info-panel.gdpr {
            background: #001020;
            border: 1px solid rgba(59,130,246,0.35);
        }

        .info-panel h3 {
            font-size: 1em;
            font-weight: 700;
            text-transform: uppercase;
            letter-spacing: 0.5px;
            margin-bottom: 10px;
        }

        .info-panel.safety h3 { color: var(--red-hover); }
        .info-panel.gdpr h3 { color: #60a5fa; }

        .info-panel ul {
            list-style: none;
            padding: 0;
        }

        .info-panel li {
            font-size: 0.95em;
            color: var(--text);
            padding: 4px 0;
            border-bottom: 1px solid rgba(255,255,255,0.05);
        }

        .info-panel li:last-child { border-bottom: none; }

        .info-panel p {
            font-size: 0.9em;
            color: var(--text);
            margin-bottom: 6px;
            line-height: 1.4;
        }

        /* ‚îÄ‚îÄ‚îÄ CHECKBOXES ‚îÄ‚îÄ‚îÄ */
        .check-group {
            display: flex;
            align-items: flex-start;
            gap: 10px;
            padding: 10px 0;
            border-bottom: 1px solid var(--border);
        }

        .check-group:last-of-type { border-bottom: none; }

        .check-group input[type="checkbox"] {
            width: 18px;
            height: 18px;
            min-width: 18px;
            margin-top: 2px;
            cursor: pointer;
            accent-color: var(--red);
        }

        .check-group label {
            text-transform: none;
            letter-spacing: 0;
            font-size: 0.9em;
            color: var(--text);
            font-weight: 400;
            margin: 0;
        }

        /* ‚îÄ‚îÄ‚îÄ VISITOR LIST ‚îÄ‚îÄ‚îÄ */
        .visitor-row {
            display: flex;
            align-items: center;
            justify-content: space-between;
            background: var(--card2);
            border: 1px solid var(--border);
            border-left: 3px solid var(--red);
            border-radius: 8px;
            padding: 14px 16px;
            margin-bottom: 8px;
            gap: 12px;
        }

        .visitor-name {
            font-size: 1.2em;
            font-weight: 700;
            color: #fff;
        }

        .visitor-meta {
            font-size: 0.85em;
            color: var(--muted);
            margin-top: 2px;
        }

        /* ‚îÄ‚îÄ‚îÄ SUCCESS SCREEN ‚îÄ‚îÄ‚îÄ */
        .success-box {
            background: #052005;
            border: 1px solid #16a34a;
            border-radius: 10px;
            padding: 24px;
            text-align: center;
        }

        .success-icon {
            font-size: 3.5em;
            margin-bottom: 10px;
        }

        .success-title {
            font-size: 2em;
            font-weight: 800;
            color: #4ade80;
            text-transform: uppercase;
            letter-spacing: 1px;
            margin-bottom: 6px;
        }

        .success-sub {
            font-size: 1em;
            color: rgba(255,255,255,0.6);
        }

        .success-host {
            background: rgba(255,255,255,0.05);
            border: 1px solid rgba(74, 222, 128, 0.3);
            border-radius: 8px;
            padding: 16px;
            margin-top: 16px;
            font-size: 1.1em;
            color: #fff;
        }

        /* ‚îÄ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ‚îÄ */
        .loading-overlay {
            position: fixed;
            inset: 0;
            background: rgba(0,0,0,0.9);
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            z-index: 9999;
            opacity: 0;
            pointer-events: none;
            transition: opacity 0.2s;
        }

        .loading-overlay.show {
            opacity: 1;
            pointer-events: all;
        }

        .spinner {
            width: 50px;
            height: 50px;
            border: 5px solid rgba(220,38,38,0.2);
            border-top-color: var(--red);
            border-radius: 50%;
            animation: spin 0.8s linear infinite;
            margin-bottom: 14px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .loading-text {
            font-size: 1.2em;
            font-weight: 600;
            color: var(--text);
            text-transform: uppercase;
            letter-spacing: 1px;
        }

        /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
        .toast {
            position: fixed;
            top: 16px;
            right: 16px;
            background: var(--card2);
            color: #fff;
            padding: 12px 18px;
            border-radius: 8px;
            border-left: 4px solid var(--red);
            font-size: 1em;
            font-weight: 600;
            opacity: 0;
            transform: translateX(120%);
            transition: all 0.25s ease;
            z-index: 10000;
        }

        .toast.show {
            opacity: 1;
            transform: translateX(0);
        }

        /* ‚îÄ‚îÄ‚îÄ VERSION BADGE ‚îÄ‚îÄ‚îÄ */
        .version-badge {
            position: fixed;
            bottom: 12px;
            left: 14px;
            background: rgba(220,38,38,0.1);
            color: rgba(220,38,38,0.6);
            border: 1px solid rgba(220,38,38,0.2);
            border-radius: 4px;
            font-size: 0.75em;
            font-weight: 600;
            letter-spacing: 0.5px;
            padding: 4px 8px;
            z-index: 100;
        }

        /* ‚îÄ‚îÄ‚îÄ EMERGENCY BUTTON ‚îÄ‚îÄ‚îÄ */
        .emergency-btn {
            position: absolute;
            top: 0;
            right: 0;
            background: #7f1d1d;
            color: #fca5a5;
            border: 1px solid #dc2626;
            border-radius: 6px;
            font-family: 'Barlow Condensed', sans-serif;
            font-size: 0.85em;
            font-weight: 700;
            letter-spacing: 0.5px;
            text-transform: uppercase;
            padding: 8px 12px;
            cursor: pointer;
        }

        /* ‚îÄ‚îÄ‚îÄ DIVIDER ‚îÄ‚îÄ‚îÄ */
        .divider {
            height: 1px;
            background: var(--border);
            margin: 10px 0;
        }

        /* ‚îÄ‚îÄ‚îÄ SIGN-IN LAYOUT: two-column form wrapper ‚îÄ‚îÄ‚îÄ */
        .signin-scroll {
            flex: 1;
            overflow-y: auto;
            min-height: 0;
        }

        .signin-scroll::-webkit-scrollbar { width: 6px; }
        .signin-scroll::-webkit-scrollbar-track { background: transparent; }
        .signin-scroll::-webkit-scrollbar-thumb { background: var(--red); border-radius: 4px; }

        /* ‚îÄ‚îÄ‚îÄ EMPTY STATE ‚îÄ‚îÄ‚îÄ */
        .empty-state {
            text-align: center;
            padding: 40px 20px;
            color: var(--muted);
            font-size: 1.1em;
        }
    </style>
</head>
<body>

<div class="version-badge">V ¬∑ B777X</div>
<div class="toast" id="toast"></div>

<div class="loading-overlay" id="loadingOverlay">
    <div class="spinner"></div>
    <div class="loading-text">Processing...</div>
</div>

<div class="shell">

    <!-- ‚îÄ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ‚îÄ -->
    <div class="header">
        <div class="header-logo">
            <img src="https://narrowaisleservice.github.io/Flexi-Parts-System/flexi-logo-white.svg"
                 alt="Flexi"
                 onerror="this.style.display='none'">
        </div>
        <div class="header-center">
            <div class="site-sub">Visitor Management</div>
        </div>
        <div class="header-clock">
            <div class="time" id="clockTime">00:00:00</div>
            <div class="date" id="clockDate">‚Äî</div>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         WELCOME SCREEN
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen active" id="welcomeScreen">

        <div class="welcome-hero card red-accent">
            <div class="title">Welcome <span style="font-size:0.8em">üëã</span></div>
            <div class="tagline">Your Space, Our Expertise</div>
        </div>

        <div class="stats-row">
            <div class="stat-card">
                <div class="stat-label">Visitors Today</div>
                <div class="stat-value" id="welcomeTodayCount">‚Äî</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Currently On-Site</div>
                <div class="stat-value" id="welcomeCurrentCount">‚Äî</div>
            </div>
        </div>

        <div class="btn-row" style="margin-top: 10px;">
            <button class="btn btn-primary" onclick="showScreen('signinScreen')">
                üìù Sign In
            </button>
            <button class="btn btn-outline" onclick="showScreen('signoutScreen')">
                üëã Sign Out
            </button>
        </div>

    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SIGN-IN SCREEN
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="signinScreen">

        <div style="flex-shrink:0; padding-bottom: 4px;">
            <div class="screen-title">Visitor Sign-In</div>
            <div class="screen-sub">Complete all required fields to register your visit</div>
            <div class="progress-track">
                <div class="progress-fill" id="progressFill"></div>
            </div>
        </div>

        <div class="signin-scroll">
            <form id="signinForm">

                <div class="card">
                    <div class="form-grid">
                        <div class="form-group">
                            <label>Full Name <span class="req">*</span></label>
                            <input type="text" id="visitorName" placeholder="e.g. John Smith" required>
                        </div>
                        <div class="form-group">
                            <label>Company Name <span class="req">*</span></label>
                            <input type="text" id="companyName" placeholder="e.g. Acme Ltd" required>
                        </div>
                        <div class="form-group">
                            <label>Here to see <span class="req">*</span></label>
                            <select id="hostName" required>
                                <option value="">‚Äî Select person ‚Äî</option>
                                <option value="Alex Coley|A.Coley@narrowaisle.co.uk">Alex Coley ‚Äì Technical Support</option>
                                <option value="Beth Henley|b.henley@narrowaisle.co.uk">Beth Henley ‚Äì Rental Manager</option>
                                <option value="Chloe Burrows|c.burrows@narrowaisle.co.uk">Chloe Burrows ‚Äì Service Controller</option>
                                <option value="Donald Houston|d.houston@narrowaisle.co.uk">Donald Houston ‚Äì Group MD</option>
                                <option value="Emma Partridge|e.partridge@narrowaisle.co.uk">Emma Partridge ‚Äì Credit Controller</option>
                                <option value="Eric Holt|e.holt@narrowaisle.co.uk">Eric Holt ‚Äì Head of Operations</option>
                                <option value="Gavin Martin|g.martin@narrowaisle.co.uk">Gavin Martin ‚Äì Head of International</option>
                                <option value="Guy Whitehurst|g.whitehurst@narrowaisle.co.uk">Guy Whitehurst ‚Äì Business Ops Manager</option>
                                <option value="James Williams|J.Williams@narrowaisle.co.uk">James Williams ‚Äì Parts &amp; Service</option>
                                <option value="Jane Robbins|j.robbins@narrowaisle.co.uk">Jane Robbins ‚Äì Service Controller</option>
                                <option value="Jim Barker|j.barker@narrowaisle.co.uk">Jim Barker ‚Äì Production Manager</option>
                                <option value="Joseph Wesley|jt.wesley@narrowaisle.co.uk">Joseph Wesley ‚Äì Used Truck Sales</option>
                                <option value="Karen Bell|k.bell@narrowaisle.co.uk">Karen Bell ‚Äì Service Controller</option>
                                <option value="Kellie Jones|ka.jones@narrowaisle.co.uk">Kellie Jones ‚Äì Purchase Ledger</option>
                                <option value="Kris Jones|parts@narrowaisle.co.uk">Kris Jones ‚Äì Parts Controller</option>
                                <option value="Lee Burt|l.burt@narrowaisle.co.uk">Lee Burt ‚Äì Head of Service &amp; Parts</option>
                                <option value="Martin Jones|martin.jones@narrowaisle.co.uk">Martin Jones ‚Äì Strategic Development</option>
                                <option value="Michael Coley|m.coley@narrowaisle.co.uk">Michael Coley ‚Äì QMS Engineer</option>
                                <option value="Michelle Ball|m.ball@narrowaisle.co.uk">Michelle Ball ‚Äì Payroll</option>
                                <option value="Nigel Langford|n.langford@narrowaisle.co.uk">Nigel Langford ‚Äì Scheduling &amp; Quality</option>
                                <option value="Paul Burns|p.burns@narrowaisle.co.uk">Paul Burns ‚Äì Design Engineer</option>
                                <option value="Phil Grant|p.grant@narrowaisle.co.uk">Phil Grant ‚Äì Operations Service Manager</option>
                                <option value="Rob Edwards|r.edwards@narrowaisle.co.uk">Rob Edwards ‚Äì Strategic Account Manager</option>
                                <option value="Sarah Lockley|s.lockley@narrowaisle.co.uk">Sarah Lockley ‚Äì Finance &amp; Personnel</option>
                                <option value="Steve Clarke|s.clark@narrowaisle.co.uk">Steve Clarke ‚Äì Financial Controller</option>
                                <option value="Steve Moore|steven.m@narrowaisle.co.uk">Steve Moore ‚Äì Design Engineer</option>
                                <option value="Steve Seymour|s.seymour@narrowaisle.co.uk">Steve Seymour ‚Äì Training Manager</option>
                                <option value="Stuart Hill|s.hill@narrowaisle.co.uk">Stuart Hill ‚Äì Senior Designer</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Purpose of Visit <span class="req">*</span></label>
                            <select id="visitPurpose" required>
                                <option value="">‚Äî Select purpose ‚Äî</option>
                                <option value="Meeting">ü§ù Meeting</option>
                                <option value="Delivery">üì¶ Delivery</option>
                                <option value="Service">üîß Service</option>
                                <option value="Interview">üíº Interview</option>
                                <option value="Other">üìã Other</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Vehicle Registration <span style="color:var(--muted); text-transform:none; letter-spacing:0;">(optional)</span></label>
                            <input type="text" id="vehicleReg" placeholder="e.g. AB12 CDE" style="text-transform:uppercase;">
                        </div>
                        <div class="form-group">
                            <label>Your Email <span style="color:var(--muted); text-transform:none; letter-spacing:0;">(optional)</span></label>
                            <input type="email" id="visitorEmail" placeholder="your@email.com">
                        </div>
                    </div>
                </div>

                <!-- Health & Safety -->
                <div class="info-panel safety">
                    <h3>‚ö†Ô∏è Health &amp; Safety</h3>
                    <ul>
                        <li><strong>üö® Fire Assembly Point:</strong> Main Car Park</li>
                        <li><strong>üè• First Aiders:</strong> Wear green hi-vis vests</li>
                        <li><strong>üöπ Men's Toilets:</strong> Through main entrance, on right</li>
                        <li><strong>üö∫ Women's Toilets:</strong> Through office, towards kitchen, left</li>
                    </ul>
                </div>

                <!-- GDPR -->
                <div class="info-panel gdpr">
                    <h3>üîí Data Protection &amp; Privacy (GDPR)</h3>
                    <p><strong>We respect your privacy.</strong> Your information is processed in accordance with UK GDPR and Data Protection Act 2018.</p>
                    <p><strong>Why we collect your data:</strong> Health &amp; Safety compliance, security and premises management, and communication with your host.</p>
                    <p>Data is stored securely and retained only as long as necessary. You have the right to access, correct, or request deletion of your data. We will not share your data with third parties without consent.</p>
                </div>

                <!-- Consent checkboxes -->
                <div class="card" style="padding: 14px 16px;">
                    <div class="check-group">
                        <input type="checkbox" id="safetyAgree" required>
                        <label for="safetyAgree">I understand and accept the Health &amp; Safety information <span class="req">*</span></label>
                    </div>
                    <div class="check-group">
                        <input type="checkbox" id="gdprAgree" required>
                        <label for="gdprAgree">I consent to my data being processed in accordance with the GDPR statement above <span class="req">*</span></label>
                    </div>
                </div>

                <div style="display: grid; grid-template-columns: 1fr 1fr; gap: 10px; margin-top: 4px; padding-bottom: 16px;">
                    <button type="submit" class="btn btn-primary">Submit Sign-In</button>
                    <button type="button" class="btn btn-outline" onclick="showScreen('welcomeScreen')">Cancel</button>
                </div>

            </form>
        </div>
    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SUCCESS SCREEN
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="successScreen" style="justify-content: center; align-items: center; padding: 20px;">

        <div class="success-box" style="max-width: 500px; width: 100%;">
            <div class="success-icon">‚úÖ</div>
            <div class="success-title">Signed In!</div>
            <div class="success-sub">Thank you for registering your visit</div>
            <div class="success-host" id="successHostBox">‚Äî</div>
        </div>

        <button class="btn btn-outline" style="margin-top: 20px; max-width: 500px;"
                onclick="showScreen('welcomeScreen')">
            ‚Üê Back to Welcome
        </button>

    </div>

    <!-- ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
         SIGN-OUT SCREEN
    ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê -->
    <div class="screen" id="signoutScreen">

        <div style="flex-shrink:0; position: relative; padding-bottom: 4px;">
            <div class="screen-title">Sign Out</div>
            <div class="screen-sub">Select your name to sign out</div>
            <button class="emergency-btn" onclick="triggerEmergencyMode()">üö® Emergency</button>
        </div>

        <div class="stats-row" style="flex-shrink:0; margin-bottom: 10px;">
            <div class="stat-card">
                <div class="stat-label">Visitors Today</div>
                <div class="stat-value" id="statsTodayCount">‚Äî</div>
            </div>
            <div class="stat-card">
                <div class="stat-label">Currently On-Site</div>
                <div class="stat-value" id="statsCurrentCount">‚Äî</div>
            </div>
        </div>

        <div id="visitorList" style="flex:1; overflow-y:auto; min-height:0;"></div>

        <button class="btn btn-outline btn-sm" onclick="showScreen('welcomeScreen')"
                style="margin-top: 10px; flex-shrink:0;">
            ‚Üê Back to Welcome
        </button>

    </div>

</div><!-- /shell -->

<script>
    const SCRIPT_URL = 'https://script.google.com/macros/s/AKfycbyI8cHuRpKec2e28byX8tz85Z09Ze0TGebnugkD7uC2hg6bfWYvP9dKHZLGvrCje0B5aA/exec';

    /* ‚îÄ‚îÄ‚îÄ CLOCK ‚îÄ‚îÄ‚îÄ */
    function updateClock() {
        const now = new Date();
        document.getElementById('clockTime').textContent = now.toLocaleTimeString('en-GB');
        document.getElementById('clockDate').textContent = now.toLocaleDateString('en-GB', {
            weekday: 'short', day: 'numeric', month: 'short', year: 'numeric'
        });
    }
    updateClock();
    setInterval(updateClock, 1000);

    /* ‚îÄ‚îÄ‚îÄ SCREENS ‚îÄ‚îÄ‚îÄ */
    function showScreen(id) {
        document.querySelectorAll('.screen').forEach(s => s.classList.remove('active'));
        const s = document.getElementById(id);
        s.classList.add('active');
        if (s.querySelector('.signin-scroll')) s.querySelector('.signin-scroll').scrollTop = 0;

        if (id === 'signoutScreen') loadTodaysVisitors();
        if (id === 'welcomeScreen') loadWelcomeStats();
        if (id === 'successScreen') setTimeout(() => showScreen('welcomeScreen'), 30000);
    }

    /* ‚îÄ‚îÄ‚îÄ LOADING ‚îÄ‚îÄ‚îÄ */
    function showLoading(msg = 'Processing...') {
        document.getElementById('loadingOverlay').querySelector('.loading-text').textContent = msg;
        document.getElementById('loadingOverlay').classList.add('show');
    }
    function hideLoading() {
        document.getElementById('loadingOverlay').classList.remove('show');
    }

    /* ‚îÄ‚îÄ‚îÄ TOAST ‚îÄ‚îÄ‚îÄ */
    function showToast(msg) {
        const t = document.getElementById('toast');
        t.textContent = msg;
        t.classList.add('show');
        setTimeout(() => t.classList.remove('show'), 3000);
    }

    /* ‚îÄ‚îÄ‚îÄ PROGRESS ‚îÄ‚îÄ‚îÄ */
    document.querySelectorAll('#signinForm [required]').forEach(f => {
        f.addEventListener('input', updateProgress);
        f.addEventListener('change', updateProgress);
    });

    function updateProgress() {
        const fields = document.querySelectorAll('#signinForm [required]');
        const filled = Array.from(fields).filter(f =>
            f.type === 'checkbox' ? f.checked : f.value.trim() !== ''
        ).length;
        document.getElementById('progressFill').style.width = (filled / fields.length * 100) + '%';
    }

    /* ‚îÄ‚îÄ‚îÄ WELCOME STATS ‚îÄ‚îÄ‚îÄ */
    async function loadWelcomeStats() {
        try {
            const today = new Date().toLocaleDateString('en-GB');
            const r = await fetch(`${SCRIPT_URL}?action=getTodaysVisitors&date=${today}`);
            const visitors = await r.json();
            const current = visitors.filter(v => v.status === 'Signed In');
            document.getElementById('welcomeTodayCount').textContent = visitors.length;
            document.getElementById('welcomeCurrentCount').textContent = current.length;
        } catch {
            document.getElementById('welcomeTodayCount').textContent = '0';
            document.getElementById('welcomeCurrentCount').textContent = '0';
        }
    }
    loadWelcomeStats();
    setInterval(loadWelcomeStats, 30000);

    /* ‚îÄ‚îÄ‚îÄ SIGN IN ‚îÄ‚îÄ‚îÄ */
    document.getElementById('signinForm').addEventListener('submit', async function(e) {
        e.preventDefault();
        showLoading('Signing in...');

        const hostParts = document.getElementById('hostName').value.split('|');
        const data = {
            action: 'signin',
            timestamp: new Date().toISOString(),
            date: new Date().toLocaleDateString('en-GB'),
            timeIn: new Date().toLocaleTimeString('en-GB'),
            visitorName: document.getElementById('visitorName').value,
            companyName: document.getElementById('companyName').value,
            hostName: hostParts[0],
            hostEmail: hostParts[1],
            visitPurpose: document.getElementById('visitPurpose').value,
            vehicleReg: document.getElementById('vehicleReg').value,
            visitorEmail: document.getElementById('visitorEmail').value,
            status: 'Signed In'
        };

        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify(data)
            });

            await new Promise(r => setTimeout(r, 1000));
            hideLoading();

            document.getElementById('successHostBox').innerHTML =
                `<strong>${data.hostName}</strong> has been notified üìß<br>
                 <span style="font-size:0.9em; color:var(--muted)">Please wait at reception</span>`;

            showScreen('successScreen');
            showToast('‚úÖ Signed in successfully');
            document.getElementById('signinForm').reset();
            document.getElementById('progressFill').style.width = '0%';

        } catch {
            hideLoading();
            showToast('‚ùå Error ‚Äì please try again');
        }
    });

    /* ‚îÄ‚îÄ‚îÄ SIGN OUT LIST ‚îÄ‚îÄ‚îÄ */
    async function loadTodaysVisitors() {
        const list = document.getElementById('visitorList');
        showLoading('Loading visitors...');
        list.innerHTML = '';

        try {
            const today = new Date().toLocaleDateString('en-GB');
            const r = await fetch(`${SCRIPT_URL}?action=getTodaysVisitors&date=${today}`);
            const visitors = await r.json();
            const current = visitors.filter(v => v.status === 'Signed In');

            document.getElementById('statsTodayCount').textContent = visitors.length;
            document.getElementById('statsCurrentCount').textContent = current.length;
            hideLoading();

            if (current.length === 0) {
                list.innerHTML = '<div class="empty-state">üì≠ No visitors currently signed in</div>';
            } else {
                list.innerHTML = current.map(v => `
                    <div class="visitor-row">
                        <div>
                            <div class="visitor-name">üë§ ${v.visitorName}</div>
                            <div class="visitor-meta">üè¢ ${v.companyName} &nbsp;¬∑&nbsp; üë®‚Äçüíº ${v.hostName} &nbsp;¬∑&nbsp; ‚è∞ ${v.timeIn}</div>
                        </div>
                        <button class="btn btn-primary btn-sm"
                                onclick="signOut('${v.id}', '${v.visitorName}')">
                            Sign Out ‚Üí
                        </button>
                    </div>
                `).join('');
            }
        } catch {
            hideLoading();
            list.innerHTML = '<div class="empty-state" style="color:#f87171;">‚ùå Error loading visitors</div>';
        }
    }

    async function signOut(id, name) {
        if (!confirm(`Sign out ${name}?`)) return;
        showLoading('Signing out...');

        try {
            await fetch(SCRIPT_URL, {
                method: 'POST',
                mode: 'no-cors',
                headers: { 'Content-Type': 'application/json' },
                body: JSON.stringify({
                    action: 'signout',
                    id: id,
                    timeOut: new Date().toLocaleTimeString('en-GB'),
                    status: 'Signed Out'
                })
            });

            await new Promise(r => setTimeout(r, 1000));
            hideLoading();
            showToast(`‚úÖ ${name} signed out`);
            setTimeout(loadTodaysVisitors, 400);
        } catch {
            hideLoading();
            showToast('‚ùå Error ‚Äì please try again');
        }
    }

    /* ‚îÄ‚îÄ‚îÄ EMERGENCY ‚îÄ‚îÄ‚îÄ */
    async function triggerEmergencyMode() {
        const pwd = prompt('‚ö†Ô∏è EMERGENCY MODE\n\nEnter password:');
        if (pwd !== 'FLEXI2026') {
            if (pwd !== null) alert('‚ùå Incorrect password');
            return;
        }
        if (!confirm('üö® Sign out ALL visitors on-site?')) return;

        const overlay = document.createElement('div');
        overlay.style.cssText = 'position:fixed;inset:0;background:rgba(180,0,0,0.97);display:flex;align-items:center;justify-content:center;z-index:20000;color:#fff;font-family:Barlow Condensed,sans-serif;font-size:2.5em;font-weight:800;text-align:center;text-transform:uppercase;letter-spacing:2px;';
        overlay.innerHTML = '<div><div style="font-size:1.5em">üö®</div><div>Emergency Sign-Out</div><div style="font-size:0.5em;margin-top:12px;opacity:0.7">Processing...</div></div>';
        document.body.appendChild(overlay);

        try {
            const today = new Date().toLocaleDateString('en-GB');
            const r = await fetch(`${SCRIPT_URL}?action=getTodaysVisitors&date=${today}`);
            const visitors = await r.json();
            const timeOut = new Date().toLocaleTimeString('en-GB');

            for (const v of visitors.filter(v => v.status === 'Signed In')) {
                await fetch(SCRIPT_URL, {
                    method: 'POST',
                    mode: 'no-cors',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ action: 'signout', id: v.id, timeOut, status: 'Emergency Sign Out' })
                });
            }

            overlay.innerHTML = '<div><div style="font-size:1.5em">‚úÖ</div><div>Complete</div></div>';
            setTimeout(() => { overlay.remove(); loadTodaysVisitors(); }, 3000);
        } catch {
            overlay.innerHTML = '<div><div style="font-size:1.5em">‚ùå</div><div>Error</div></div>';
            setTimeout(() => overlay.remove(), 3000);
        }
    }
</script>
</body>
</html>
